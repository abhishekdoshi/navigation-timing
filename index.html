<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Navigation Timing Level 2</title>
  <script src='//www.w3.org/Tools/respec/respec-w3c-common' async class='remove'></script>
  <script class='remove'>
  var respecConfig = {
    shortName: "navigation-timing-2",
    specStatus: "ED",
    useExperimentalStyles: true,
    edDraftURI: "https://w3c.github.io/navigation-timing/",
    editors: [{
      name: "Tobin Titus",
      mailto: "tobint@microsoft.com",
      company: "Microsoft Corp.",
      w3cid: "69474"
    }, {
      name: "Jatinder Mann",
      mailto: "jmann@microsoft.com",
      company: "Microsoft Corp.",
      note: "Until February 2014",
      w3cid: "44357"
    }, {
      name: "Arvind Jain",
      mailto: "arvind@google.com",
      company: "Google Inc.",
      note: "Until December 2014",
      w3cid: "45188"
    }],
    wg: "Web Performance Working Group",
    wgURI: "http://www.w3.org/2010/webperf/",
    wgPublicList: "public-web-perf",
    subjectPrefix: "[NavigationTiming]",
    testSuiteURI: 'https://github.com/w3c/web-platform-tests/tree/master/navigation-timing',
    otherLinks: [{
      key: 'Repository',
      data: [{
        value: 'We are on GitHub.',
        href: 'https://github.com/w3c/navigation-timing/'
      }, {
        value: 'File a bug.',
        href: 'https://github.com/w3c/navigation-timing/issues'
      }, {
        value: 'Commit history.',
        href: 'https://github.com/w3c/navigation-timing/commits/gh-pages/index.html'
      }]
    },{
      key: 'Mailing list',
      data: [{
        value: 'public-web-perf@w3.org',
        href: 'https://lists.w3.org/Archives/Public/public-web-perf/'
      }]
    },{
      key: 'Implementation',
      data: [{
        value: 'Can I use Navigation Timing?',
        href: 'http://caniuse.com/#feat=nav-timing'
      }, {
        value: 'Test Suite',
        href: 'http://w3c-test.org/navigation-timing/'
      }, {
        value: 'Test Suite repository',
        href: 'https://github.com/w3c/web-platform-tests/tree/master/navigation-timing'
      }]
    }],
    localBiblio:  {
    "JSMEASURE": {
        title:    "Measuring Client-Perceived Response Times on the WWW"
    ,   href:     "http://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.69.7329&rep=rep1&type=pdf"
    ,   authors:  [
            "Ramakrishnan Rajamony"
        ,   "Mootaz Elnozahy"
        ]
    ,   status:  "The Proceedings of the 3rd USENIX Symposium on Internet Technologies and Systems (USITS)"
    ,   date: "March 2001"
    }
    },
    wgPatentURI:  "http://www.w3.org/2004/01/pp-impl/45211/status"
  };
  </script>
</head>

<body>

<section id="abstract">
  <p>This specification defines an interface for web applications to access the complete timing information for navigation of a document.</p>
</section>

<section id="sotd">
<p>This is a <strong>work in progress</strong> and may change without any
notices. </p>

<p>
 Navigation Timing 2 replaces the first version of [[NAVIGATION-TIMING]]
 and includes the following changes:
</p>
<ul>
<li>the definition of Performance interface was moved to [[PERFORMANCE-TIMELINE-2]];</li>
<li>support for [[PERFORMANCE-TIMELINE-2]];</li>
<li>support for [[HR-TIME-2]];</li>
<li>Now builds on top of [[RESOURCE-TIMING]];</li>
<li>the <a href='#widl-PerformanceNavigationTiming-redirectCount'>number of redirects</a> since the last non-redirect navigation;</li>
<li><a href='#widl-PerformanceNavigationTiming-nextHopProtocol'>protocol</a> information;</li>
<li><a href='#widl-PerformanceNavigationTiming-transferSize'>transfer</a>, <a href='#widl-PerformanceNavigationTiming-encodedBodySize'>encoded body</a> and <a href='#widl-PerformanceNavigationTiming-decodedBodySize'>decoded body</a> size information;</li>
<li>support for <a href="http://www.w3.org/TR/resource-hints/#prerender">prerender</a> navigation [[RESOURCE-HINTS]].</li>
<li>the <a href='#widl-PerformanceNavigationTiming-secureConnectionStart'>secureConnectionStart</a> attribute is now mandatory. <strong>NEW!</strong></li>
</ul>

<p id="unstable"><strong class="redNote">Implementers SHOULD be aware that this document is not
        stable.</strong> Implementers who are not taking part in the discussions
        are likely to find the specification changing out from under them in
        incompatible ways. Vendors interested in implementing this document
        before it eventually reaches the Candidate Recommendation stage SHOULD
        join the aforementioned mailing lists and take part in the discussions.</p>
</section>

<section id="introduction" class='informative'>
<h2>Introduction</h2>

<p>Accurately measuring performance characteristics of web applications is an important aspect of making web applications faster. While JavaScript-based mechanisms, such as the one described in [[JSMEASURE]], can provide comprehensive instrumentation for user latency measurements within an application, in many cases, they are unable to provide a complete or detailed end-to-end latency picture. For example, the following JavaScript shows a naive attempt to measure the time it takes to fully load a page:</p>

<pre class='example highlight'>&lt;html&gt;
&lt;head&gt;
&lt;script type="text/javascript"&gt;
var start = new Date().getTime();
function onLoad() {
  var now = new Date().getTime();
  var latency = now - start;
  alert("page loading time: " + latency);
}
&lt;/script&gt;
&lt;/head&gt;
&lt;body onload="onLoad()"&gt;
&lt;!- Main page body goes from here. --&gt;
&lt;/body&gt;
&lt;/html&gt;</pre>

<p>The above script calculates the time it takes to load the page <b>after</b> the first bit of JavaScript in the head is executed, but it does not give any information about the time it takes to get the page from the server, or the initialization lifecycle of the page.</p>

<p>This specification defines the <a>PerformanceNavigationTiming</a> interface which participates in the [[PERFORMANCE-TIMELINE-2]] to store and retrieve high resolution performance metric data related to the navigation of a document. As the <a>PerformanceNavigationTiming</a> interface uses [[HR-TIME-2]], all time values are measured from the start of the navigation. For example, if we know that the response end occurs 100ms after the start of navigation, we MAY find data that the <a>PerformanceNavigationTiming</a> data looks like so:</p>

<pre class="example highlight">
startTime:           0.000  // start time of the navigation request
responseEnd:       100.000  // high resolution time of last received byte
</pre>

<p>The following script shows how a developer can use the <a>PerformanceNavigationTiming</a> interface to obtain accurate timing data related to the navigation of the document:</p>

<pre class="example highlight">
&lt;!doctype html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;/head&gt;
&lt;body onload="init()"&gt;
&lt;script&gt;
function init() {
  var navigationTiming = performance.getEntriesByType("navigation")[0];
  if (window.console) {
    console.log("Name: "       + navigationTiming.name      + "\n" +
                "Entry Type: " + navigationTiming.entryType + "\n" +
                "Start Time: " + navigationTiming.startTime + "\n" +
                "Duration: "   + navigationTiming.duration  + "\n" +
                "Unload: "     + (navigationTiming.unloadEventEnd -
                                  navigationTiming.unloadEventStart)  + "\n" +
                "Redirect: "   + (navigationTiming.redirectEnd -
                                  navigationTiming.redirectStart)     + "\n" +
                "App Cache: "  + (navigationTiming.domainLookupStart -
                                  navigationTiming.fetchStart)        + "\n" +
                "DNS: "        + (navigationTiming.domainLookupEnd -
                                  navigationTiming.domainLookupStart) + "\n" +
                "TCP: "        + (navigationTiming.connectEnd -
                                  navigationTiming.connectStart)      + "\n" +
                "Request: "    + (navigationTiming.responseStart -
                                  navigationTiming.requestStart)      + "\n" +
                "Response: "   + (navigationTiming.responseEnd -
                                  navigationTiming.responseStart)     + "\n" +
                "Processing: " + (navigationTiming.loadEventStart -
                                  navigationTiming.responseEnd)       + "\n" +
                "Onload: "     + (navigationTiming.loadEventEnd -
                                  navigationTiming.loadEventStart)    + "\n");
  }
}
&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</pre>
</section>

<section  id="conformance">

<p>Requirements phrased in the imperative as part of algorithms (such as
"strip any leading space characters" or "return false and abort these steps")
are to be interpreted with the meaning of the key word ("MUST", "SHOULD",
"MAY", etc) used in introducing the algorithm. </p>

<p>Some conformance requirements are phrased as requirements on attributes,
methods or objects. Such requirements are to be interpreted as requirements
on user agents. </p>

<p>Conformance requirements phrased as algorithms or specific steps MAY be
implemented in any manner, so long as the end result is equivalent. (In
particular, the algorithms defined in this specification are intended to be
easy to follow, and not intended to be performant.) </p>

    <p>The IDL fragments in this specification must be interpreted as
    required for conforming IDL fragments, as described in the Web IDL
    specification. [[!WebIDL]]</p>
</section>

<section id="terminology">
<h2>Terminology</h2>
  <p>The construction "a <code>Foo</code> object", where <code>Foo</code> is actually an interface, is sometimes used instead of the more accurate "an object implementing the interface <code>Foo</code>.</p>

  <p>The term <dfn>navigation</dfn> refers to the act of <a href="http://www.w3.org/TR/html5/browsers.html#navigate">navigating</a>.</p>

  <p>The term <dfn>current document</dfn> refers to the document associated with the <a href="http://www.w3.org/TR/html5/browsers.html#dom-document-0">Window object's newest Document object</a>.</p>

  <p>The term <dfn>JavaScript</dfn> is used to refer to ECMA262, rather than the
official term ECMAScript, since the term JavaScript is more widely known. [[ECMA-262]]</p>

  <p>Throughout this work, all time values are measured in milliseconds since the start of navigation of the document. For example, the start of navigation of the document occurs at time 0. The term <i>current time</i> refers to the number of milliseconds since the start of navigation of the document until the current moment in time. This definition of time is based on [[HR-TIME-2]] specification.</p>
</section>

<section id="sec-navigation-timing">
<h2>Navigation Timing</h2>

<section id='performanceentry'>
<h3>Relation with the <a href="http://www.w3.org/TR/performance-timeline-2/#idl-def-PerformanceEntry">PerformanceEntry</a> interface</h3>

<p>The <a>PerformanceNavigationTiming</a> interface participates in the [[!PERFORMANCE-TIMELINE-2]] and extends the following attributes of the <a href="http://www.w3.org/TR/performance-timeline-2/#idl-def-PerformanceEntry">PerformanceEntry</a> interface:</p>

<dl class='attributes'>
  <dt id='widl-PerformanceNavigationTiming-name'><code>name</code></dt>
  <dd>This attribute MUST return the <code>DOMString</code> "<code>document</code>".</dd>

  <dt id='widl-PerformanceNavigationTiming-entryType'><code>entryType</code></dt>
  <dd>This attribute MUST return the <code>DOMString</code> "<code id="perf-navigation">navigation</code>".</dd>

  <dt id='widl-PerformanceNavigationTiming-startTime'><code>startTime</code></dt>
  <dd>This attribute MUST return a <a href="http://www.w3.org/TR/hr-time-2/#dom-domhighrestimestamp">DOMHighResTimeStamp</a> with a time value of 0. [[!HR-TIME-2]]</dd>

  <dt id='widl-PerformanceNavigationTiming-duration'><code>duration</code></dt>
  <dd>This attribute MUST return a <a href="http://www.w3.org/TR/hr-time-2/#dom-domhighrestimestamp">DOMHighResTimeStamp</a> equal to the difference between <a href="#widl-PerformanceNavigationTiming-loadEventEnd">loadEventEnd</a> and <a href="#widl-PerformanceNavigationTiming-startTime">startTime</a>, respectively.</dd>
</dl>

</section>

<section id='PerformanceResourceTiming'>
<h3>Relation with the <a href="http://www.w3.org/TR/resource-timing/#idl-def-PerformanceResourceTiming">PerformanceResourceTiming</a> interface</h3>

<p>Only the <a>current document</a> resource gets included as the <em>only</em> <a>PerformanceNavigationTiming</a> object in the Performance Timeline of the relevant context.</p>

<p>The <a>PerformanceNavigationTiming</a> interface extends the following attributes of the <a href="http://www.w3.org/TR/resource-timing/#idl-def-PerformanceResourceTiming">PerformanceResourceTiming</a> interface:</p>

<dl class='attributes'>
  <dt id='widl-PerformanceNavigationTiming-initiatorType'><code>initiatorType</code></dt>
  <dd>This attribute MUST return the empty <code>DOMString</code> "".
  <p class='ednote'>Should it return something else, like <code>"navigation"</code>?</p>
  </dd>

  <dt id='widl-PerformanceNavigationTiming-workerStart'><code>workerStart</code></dt>
  <dd>If the <a>current document</a> has an <a href="http://www.w3.org/TR/service-workers/#dfn-containing-service-worker-registration">active service worker registration</a> ([[!SERVICE-WORKERS]]), this attribute MUST return the time immediately before the user agent <a href="http://www.w3.org/TR/service-workers/#service-worker-concept">ran the worker</a> required to service the request, or if the worker was already available, the time immediately before the user agent <a href="http://www.w3.org/TR/service-workers/#on-fetch-request-algorithm">fired an event named `fetch`</a> at the <a href="http://www.w3.org/TR/service-workers/#dfn-active-worker">active worker</a>. Otherwise, if there is no active worker this attribute MUST return zero.</dd>

</dl>

</section>

<section id="sec-PerformanceNavigationTiming">
<h3>The <code>PerformanceNavigationTiming</code> interface</h3>

<!-- from domainLookupEnd -->
<div class="note">
<p>Checking and retrieving contents from the
<a href="https://tools.ietf.org/html/rfc7234">HTTP cache</a> [[RFC7234]]
is part of the <a href="http://www.w3.org/TR/html5/infrastructure.html#fetch" title='fetch'>
fetching process</a>. It's covered by the
<a href="#widl-PerformanceNavigationTiming-requestStart">requestStart</a>,
<a href="#widl-PerformanceNavigationTiming-responseStart">responseStart</a> and
<a href="#widl-PerformanceNavigationTiming-responseEnd">responseEnd</a> attributes.</p>
</div>

<dl title='interface PerformanceNavigationTiming : PerformanceResourceTiming' class='idl'>

<dt>readonly attribute DOMHighResTimeStamp unloadEventStart</dt>
<dd>
<p>If the previous document and the <a>current document</a> have the same
<a href="http://tools.ietf.org/html/rfc6454">origin</a>
[[!RFC6454]],
this attribute MUST return a <a href="http://www.w3.org/TR/hr-time-2/#dom-domhighrestimestamp">DOMHighResTimeStamp</a>
with a time value equal to the time immediately before the user agent starts
the <a href="http://www.w3.org/TR/html5/browsers.html#unloading-documents">unload event</a> of the previous document.

If there is no previous document or the previous document has a
different <a href="http://tools.ietf.org/html/rfc6454">origin</a> than the
<a>current document</a>, this attribute MUST return a <a href="http://www.w3.org/TR/hr-time-2/#dom-domhighrestimestamp">DOMHighResTimeStamp</a>
with a time value equal to zero.</p>
</dd>

<dt>readonly attribute DOMHighResTimeStamp unloadEventEnd</dt>
<dd>
<p>If the previous document and the <a>current document</a> have the
same <a href="http://tools.ietf.org/html/rfc6454">origin</a>,
this attribute MUST return a <a href="http://www.w3.org/TR/hr-time-2/#dom-domhighrestimestamp">DOMHighResTimeStamp</a>
with a time value equal to the time immediately after the user agent finishes the
<a href="http://www.w3.org/TR/html5/browsers.html#unloading-documents">unload event</a> of the previous document. If there is no previous document or the previous document has
a different <a href="http://tools.ietf.org/html/rfc6454">origin</a> than the
<a>current document</a> or the unload is not yet completed, this attribute MUST return a <a href="http://www.w3.org/TR/hr-time-2/#dom-domhighrestimestamp">DOMHighResTimeStamp</a>
with a time value equal to zero.</p>

<p>If there are HTTP redirects or
<a href="http://www.w3.org/TR/html5/infrastructure.html#concept-http-equivalent-codes" title='HTTP response codes equivalence'>equivalent</a>
when navigating and not all the redirects or equivalent are from the
same <a href="http://tools.ietf.org/html/rfc6454">origin</a>,
both <a href="#widl-PerformanceNavigationTiming-unloadEventStart">unloadEventStart</a> and
<a href="#widl-PerformanceNavigationTiming-unloadEventEnd">unloadEventEnd</a> MUST return a <a href="http://www.w3.org/TR/hr-time-2/#dom-domhighrestimestamp">DOMHighResTimeStamp</a>
with a time value equal to zero.</p>
</dd>

<dt>readonly attribute DOMHighResTimeStamp domInteractive</dt>
<dd>
<p>This attribute MUST return a <a href="http://www.w3.org/TR/hr-time-2/#dom-domhighrestimestamp">DOMHighResTimeStamp</a>
with a time value equal to the time immediately before the user agent sets the
<a href="http://www.w3.org/TR/html5/dom.html#current-document-readiness">current
document readiness</a> of the <a>current document</a> to
<a href="http://www.w3.org/TR/html5/syntax.html#the-end" title='"interactive" document readiness'>"interactive"</a> [[!HTML5]].</p>
</dd>

<dt>readonly attribute DOMHighResTimeStamp domContentLoadedEventStart</dt>
<dd>
<p>This attribute MUST return a <a href="http://www.w3.org/TR/hr-time-2/#dom-domhighrestimestamp">DOMHighResTimeStamp</a>
with a time value equal to the time immediately before the user agent fires the <a
href="http://www.w3.org/TR/html5/syntax.html#the-end">DOMContentLoaded
event</a> at the <a>current document</a>.</p>
</dd>

<dt>readonly attribute DOMHighResTimeStamp domContentLoadedEventEnd</dt>
<dd>
<p>This attribute MUST return a <a href="http://www.w3.org/TR/hr-time-2/#dom-domhighrestimestamp">DOMHighResTimeStamp</a>
with a time value equal to the time immediately after the <a>current document</a>'s <a
href="http://www.w3.org/TR/html5/syntax.html#the-end">DOMContentLoaded
event</a> completes.</p>
</dd>

<dt>readonly attribute DOMHighResTimeStamp domComplete</dt>
<dd>
<p>This attribute MUST return a <a href="http://www.w3.org/TR/hr-time-2/#dom-domhighrestimestamp">DOMHighResTimeStamp</a>
with a time value equal to the time immediately before the user agent sets the
<a href="http://www.w3.org/TR/html5/dom.html#current-document-readiness">current
document readiness</a> of the <a>current document</a> to
<a href="http://www.w3.org/TR/html5/syntax.html#the-end" title='"complete" document readiness'>"complete"</a> [[!HTML5]].</p>

<p>If the <a href="http://www.w3.org/TR/html5/dom.html#current-document-readiness">
current document readiness</a> changes to the same state multiple times,
<a href="#widl-PerformanceNavigationTiming-domInteractive">domInteractive</a>,
<a href="#widl-PerformanceNavigationTiming-domContentLoadedEventStart">domContentLoadedEventStart</a>,
<a href="#widl-PerformanceNavigationTiming-domContentLoadedEventEnd">domContentLoadedEventEnd</a> and
<a href="#widl-PerformanceNavigationTiming-domComplete">domComplete</a> MUST return a <a href="http://www.w3.org/TR/hr-time-2/#dom-domhighrestimestamp">DOMHighResTimeStamp</a>
with a time value equal to the time of the first
occurrence of the corresponding
<a href="http://www.w3.org/TR/html5/dom.html#current-document-readiness" title='current document readiness'>document readiness</a>
change [[!HTML5]].</p>
</dd>

<dt>readonly attribute DOMHighResTimeStamp loadEventStart</dt>
<dd>
<p>This attribute MUST return a <a href="http://www.w3.org/TR/hr-time-2/#dom-domhighrestimestamp">DOMHighResTimeStamp</a>
with a time value equal to the time immediately before the load event of
the <a>current document</a> is fired. It MUST return a <a href="http://www.w3.org/TR/hr-time-2/#dom-domhighrestimestamp">DOMHighResTimeStamp</a>
with a time value equal to zero when the load event is not
fired yet.</p>
</dd>

<dt>readonly attribute DOMHighResTimeStamp loadEventEnd</dt>
<dd>
<p>This attribute MUST return a <a href="http://www.w3.org/TR/hr-time-2/#dom-domhighrestimestamp">DOMHighResTimeStamp</a>
with a time value equal to the time when the load event of the <a>current
document</a> is completed. It MUST return a <a href="http://www.w3.org/TR/hr-time-2/#dom-domhighrestimestamp">DOMHighResTimeStamp</a>
with a time value equal to zero when the load event is not fired
or is not completed.</p>
</dd>

<dt>readonly attribute DOMHighResTimeStamp prerenderSwitch</dt>
<dd>
<p>This attribute MUST return a <a href="http://www.w3.org/TR/hr-time-2/#dom-domhighrestimestamp">DOMHighResTimeStamp</a>
with a time value equal to the time immediately after the User Agent changes the <a href="http://www.w3.org/TR/page-visibility/#dom-document-visibilitystate">visibilityState</a> of the <a>current document</a>
from <code>prerender</code> to <code>visible</code> [[!Page-Visibility]]. If the document has not been <a href='http://www.w3.org/TR/resource-hints/#prerender' title='prerender'>prerendered</a> by the User Agent [[!RESOURCE-HINTS]], this attribute MUST return a
<a href="http://www.w3.org/TR/hr-time-2/#dom-domhighrestimestamp">DOMHighResTimeStamp</a> with a time value equal to zero.
</p>
</dd>

<dt>readonly attribute NavigationType type</dt>
<dd>
<p>This attribute MUST return a <code>DOMString</code> describing the type of the last non-redirect <a
href="http://www.w3.org/TR/html5/browsers.html#navigate">navigation</a>
in the current browsing context. It MUST have one of the <a>NavigationType</a> values. </p>

<div class="note">
<p>Client-side redirects, such as those using the <a href="http://www.w3.org/TR/html5/document-metadata.html#attr-meta-http-equiv-refresh">Refresh pragma directive</a>,
are not considered HTTP redirects or <a href="http://www.w3.org/TR/html5/infrastructure.html#concept-http-equivalent-codes" title='HTTP response codes equivalence'>equivalent</a> by this spec.
In those cases, the <a href="#widl-PerformanceNavigationTiming-type">type</a> attribute SHOULD return appropriate value,
such as <a href="#idl-def-NavigationType.navigate">reload</a> if reloading the current page, or
<a href="#idl-def-NavigationType.navigate">navigate</a> if navigating to a new URL.</p>
</div>
</dd>

<dt>readonly attribute unsigned short redirectCount</dt>
<dd>
<p>This attribute MUST return the number of redirects since the last
non-redirect navigation under the current browsing context. If there is no
redirect or there is any redirect that is not from the same
<a href="http://tools.ietf.org/html/rfc6454">
origin</a> [[!RFC6454]] as the destination document, this attribute MUST return zero. </p>
</dd>

<dt>serializer = { inherit, attribute }</dt>
</dl>

<section id="sec-performance-navigation-types">
<h4>Navigation types</h4>


<dl title="enum NavigationType" class="idl">
<dt>navigate</dt>
<dd>
<p>Navigation started by clicking on a link, or entering the URL in the user
agent's address bar, or form submission, or initializing through a script operation other than the ones used by <a href="#idl-def-NavigationType.navigate">reload</a> and <a href="#idl-def-NavigationType.back_forward">back_forward</a> as listed below.</p>
</dd>
<dt>reload</dt>
<dd>
<p>Navigation through the reload operation or the
    <a href="http://www.w3.org/TR/html5/browsers.html#dom-location-reload">location.reload()</a>
    method.</p>
    </dd>
<dt>back_forward</dt>
<dd>
<p>Navigation
  through a <a href="http://www.w3.org/TR/html5/browsers.html#traverse-the-history">history traversal</a> operation.</p>
  </dd>
<dt>prerender</dt>
<dd>
<p>Navigation initiated by a <a href='http://www.w3.org/TR/resource-hints/#prerender'>prerender</a> hint [[!RESOURCE-HINTS]].</p>
</dd>
</dl>

</section>

</section>
</section>

<section id="process">
<h2>Process</h2>

<section id="processing-model">
<h3>Processing Model</h3>

<figure title='Timing attributes'>
<figcaption>
This figure illustrates the timing attributes defined by the
<a>PerformanceNavigationTiming</a> interface. Attributes in parenthesis may not be
available in navigation involving documents from different
<a href="http://tools.ietf.org/html/rfc6454" title='origin'>origins</a>. User
agents may perform internal processing in between timings, which allow for
non-normative intervals between timings.
</figcaption>
<svg xmlns="http://www.w3.org/2000/svg" width="942" height="501" style='display:block;margin:auto' >
  <defs>
    <marker refX="0" refY="0" orient="auto" id="Arrow2Mend" style="overflow:visible">
      <path d="M 8.7185878,4.0337352 -2.2072895,0.01601326 8.7185884,-4.0017078 c -1.7454984,2.3720609 -1.7354408,5.6174519 -6e-7,8.035443 z" transform="scale(-0.6,-0.6)" id="path4234" style="fill-rule:evenodd;stroke-width:0.625;stroke-linejoin:round"/>
    </marker>
  </defs>
  <style type='text/css'>
   path { fill:none;stroke:#000080;stroke-width:1.5;stroke-opacity:1;stroke-dasharray:none;marker-end:url(#Arrow2Mend); }
   rect { fill:#00ffff;fill-opacity:1;stroke:#0000ff;stroke-width:2; }
   text { font-size:12px;font-weight: bold;text-align:center;fill:#000000;fill-opacity:1;stroke:none;font-family:monospace; }
   .middle { text-anchor:middle; }
   .end { text-anchor:end; }
   .highlight { font-style: italic; }
  </style>
  <g transform="translate(-4.3,-477.125)">
    <rect width="70" height="80" x="100" y="702"/>
    <rect width="59.999966" height="79.999962" x="880" y="702"/>
    <rect width="210" height="80" x="660" y="702"/>
    <rect width="90" height="80" x="560" y="702"/>
    <rect width="90" height="80" x="470" y="702"/>
    <rect width="60" height="80" x="400" y="702"/>
    <rect width="50" height="80" x="340" y="702"/>
    <rect width="60" height="80" x="270" y="702"/>
    <rect width="80" height="80" x="180" y="702"/>
    <rect width="160" height="50" x="690" y="762"/>
    <rect width="80" height="50" x="200" y="762"/>
    <text class="middle"><tspan x="135.28711" y="729">Prompt</tspan><tspan x="135.28711" y="747">for</tspan><tspan x="135.28711" y="764">unload</tspan></text>
    <text x="219.94189" y="747.12683" class="middle"><tspan>redirect</tspan></text>
    <text class="middle"><tspan x="299.95557" y="738">App</tspan><tspan x="300" y="755.7572">cache</tspan></text>
    <text x="365.25977" y="745" class="middle"><tspan>DNS</tspan></text>
    <text x="430.0376" y="745" class="middle"><tspan>TCP</tspan></text>
    <text x="514.8667" y="745" class="middle"><tspan>Request</tspan></text>
    <text x="605.0752" y="745" class="middle"><tspan>Response</tspan></text>
    <text x="765.01025" y="745" class="middle"><tspan>Processing</tspan></text>
    <text x="909.77441" y="745" class="middle"><tspan>load</tspan></text>
    <text x="769.86328" y="792" class="middle"><tspan>DOMContentLoaded</tspan></text>
    <text x="239.97607" y="792.12683" class="middle"><tspan>unload</tspan></text>
    <text x="490" y="532" class='highlight'><tspan>startTime</tspan></text>
    <text x="490" y="552.60315"  class='highlight'><tspan>redirectStart</tspan></text>
    <text x="490" y="593.08502"><tspan>fetchStart</tspan></text>
    <text x="490" y="572.84412"  class='highlight'><tspan>redirectEnd</tspan></text>
    <text x="490" y="613.32599"><tspan>domainLookupStart</tspan></text>
    <text x="490" y="633.56696"><tspan>domainLookupEnd</tspan></text>
    <text x="490" y="653.56866"><tspan>connectStart</tspan></text>
    <text x="490" y="674.04889"><tspan>secureConnectionStart</tspan></text>
    <text x="490" y="694.28986"><tspan>connectEnd</tspan></text>
    <text x="440.20801" y="812" class="end"><tspan>requestStart</tspan></text>
    <text x="440.20801" y="838.98895" class="end"><tspan>responseStart</tspan></text>
    <text x="440.20801" y="865.85504" class="end"><tspan>responseEnd</tspan></text>
    <text x="858.44238" y="952" class="end"><tspan>domComplete</tspan></text>
    <text x="852.79004" y="612" class="end"><tspan>loadEventEnd</tspan></text>
    <text x="852.79004" y="644.65131" class="end"><tspan>loadEventStart</tspan></text>
    <text x="439.83203" y="919.10858" class="end"><tspan>domInteractive</tspan></text>
    <text x="439.83203" y="945.73541" class="end"><tspan>domContentLoadedEventStart</tspan></text>
    <text x="439.83203" y="972" class="end"><tspan>domContentLoadedEventEnd</tspan></text>
    <text x="144.81705" y="846" class="end highlight"><tspan>unloadEventStart</tspan></text>
    <text x="143.46094" y="872" class="end highlight"><tspan>unloadEventEnd</tspan></text>
    <path d="m 480,532 -280,0 -30,170"/>
    <path d="m 480,552 -270,0 -30,150"/>
    <path d="m 480,572 -200,0 -20,130"/>
    <path d="m 480,592 -180,0 -30,110"/>
    <path d="m 480,612 -110,0 -30,90"/>
    <path d="m 480,632 -70,0 -20,70"/>
    <path d="m 480,652 -50,0 -30,50"/>
    <path d="m 480,672 -40,0 -20,30"/>
    <path d="m 480,692 -10,0 -10,10"/>
    <path d="m 450,812 10,0 10,-30"/>
    <path d="m 450,832 50,0 60,-50"/>
    <path d="m 450,862 100,0 100,-80"/>
    <path d="m 450,922 150,0 80,-120"/>
    <path d="m 450,942 190,0 50,-130"/>
    <path d="m 450,972 220,0 180,-160"/>
    <path d="m 870,952 50,0 -60,-160"/>
    <path d="m 860,642 10,0 10,60"/>
    <path d="m 860,612 40,0 40,90"/>
    <path d="m 150,842 30,0 20,-30"/>
    <path d="m 150,872 80,0 50,-60"/>
  </g>
</svg>
</figure>

<ol>
  <li>If the navigation is aborted for any of the following reasons, abort
    these steps.
    <ol style="list-style-type:lower-alpha;">
      <li>The navigation is aborted due to the
        <a href="http://www.w3.org/TR/html5/browsers.html#sandboxed-navigation-browsing-context-flag">sandboxed
        navigation browsing context flag</a> or the
        <a href="http://www.w3.org/TR/html5/browsers.html#sandboxed-top-level-navigation-browsing-context-flag">sandboxed
        top-level navigation browsing context flag</a>, or a preexist attempt
        to navigate the <a href="http://www.w3.org/TR/html5/browsers.html#browsing-context">browsing context</a>.</li>
      <li>The navigation is caused by <a
        href="http://www.w3.org/TR/html5/browsers.html#navigate-fragid-step" title='fragment identifiers navigation'>fragment
        identifiers</a> within the page.</li>
      <li>The new resource is to be handled by some sort of inline
      content.</li>
      <li>The new resource is to be handled using a mechanism that does not
        affect the browsing context.</li>
      <li>The user <a
        href="http://www.w3.org/TR/html5/browsers.html#refused-to-allow-the-document-to-be-unloaded">refuses
        to allow the document to be unloaded</a>.</li>
    </ol>
  </li>
  <li id="step-create-object">Create a new <a>PerformanceNavigationTiming</a> object.
  </li>
  <li>Set <a href="#widl-PerformanceNavigationTiming-name">name</a> to the <code>DOMString</code> "<code>document</code>".</li>
  <li>Set <a href="#widl-PerformanceNavigationTiming-entryType">entryType</a> to the <code>DOMString</code> "<code>navigation</code>".</li>
  <li>Set <a href="#widl-PerformanceNavigationTiming-startTime">startTime</a> to a <a href="http://www.w3.org/TR/hr-time-2/#dom-domhighrestimestamp">DOMHighResTimeStamp</a> with a time value of zero, and <a href="#widl-PerformanceNavigationTiming-nextHopProtocol">nextHopProtocol</a> to the empty <code>DOMString</code>.</li>
  <li> Record the current navigation type in <a href="#widl-PerformanceNavigationTiming-type">type</a>
    if it has not been set:
    <ol style="list-style-type:lower-alpha;">
    <li>If the navigation was started by clicking on a link, or entering the URL in the user
        agent's address bar, or form submission, or initializing through a script operation other than the
        <a href="http://www.w3.org/TR/html5/browsers.html#dom-location-reload">location.reload()</a> method,
        let the navigation type be the <code>DOMString</code> "<a href="#idl-def-NavigationType.navigate">navigate</a>".</li>
    <li>If the navigation was started either as a result of a
        <a href="http://www.w3.org/TR/html5/document-metadata.html#attr-meta-http-equiv-refresh" title='Refresh pragma directive'>meta refresh</a>,
        or the <a href="http://www.w3.org/TR/html5/browsers.html#dom-location-reload">location.reload()</a>
        method, or other equivalent actions, let the navigation type
        be the <code>DOMString</code> "<a href="#idl-def-NavigationType.reload">reload</a>".</li>
    <li>If the navigation was started as a result of
        <a href="http://www.w3.org/TR/html5/browsers.html#traverse-the-history">history traversal</a>,
        let the navigation type be the <code>DOMString</code> "<a href="#idl-def-NavigationType.back_forward">back_forward</a>".</li>
    </ol>
  </li>
  <li>If the current document and the previous document are from different
    <a href="http://tools.ietf.org/html/rfc6454" title='origin'>origins</a>,
    set both <a href="#widl-PerformanceNavigationTiming-unloadEventEnd">unloadEventStart</a> and
    <a href="#widl-PerformanceNavigationTiming-unloadEventEnd">unloadEventEnd</a> to 0 then go to step
    <a href="#step-linknegotiation-start">9</a>. Otherwise, record <a href="#widl-PerformanceNavigationTiming-unloadEventEnd">unloadEventStart</a>
    as the time immediately before the unload event.</li>
  <li>Immediately after the unload event is completed, record the current time as <a href="#widl-PerformanceNavigationTiming-unloadEventEnd">unloadEventEnd</a>. If the navigation URL has an <a href="http://www.w3.org/TR/service-workers/#dfn-active-worker">active worker registration</a>, immediately before the user agent <a href="http://www.w3.org/TR/service-workers/#service-worker-concept">runs the worker</a> record the time as <a href="#widl-PerformanceNavigationTiming-workerStart">workerStart</a>, or if the worker is available, record the time before the <a href="http://www.w3.org/TR/service-workers/#on-fetch-request-algorithm">event named `fetch` is fired</a> at the active worker. Otherwise, if the navigation URL has no matching <a href="http://www.w3.org/TR/service-workers/#dfn-service-worker-registration">service worker registration</a>, set <a href="#widl-PerformanceNavigationTiming-workerStart">workerStart</a> value to zero.</li>
  <li id="step-fetch-start">If the new resource is to be fetched using HTTP GET
    or <a href="http://www.w3.org/TR/html5/infrastructure.html#concept-http-equivalent-get" title='HTTP GET method equivalence'>equivalent</a>,
    immediately before a user agent checks with the <a
    href="http://www.w3.org/TR/html5/browsers.html#relevant-application-cache" title="relevant application cache">
    relevant application caches</a>, record the current time as
    <a href="#widl-PerformanceNavigationTiming-fetchStart">fetchStart</a>. Otherwise, immediately before a user agent starts the
    <a href="http://www.w3.org/TR/html5/infrastructure.html#fetch" title='fetch'>
    fetching process</a>, record the current time as <a href="#widl-PerformanceNavigationTiming-fetchStart">fetchStart</a>.</li>
  <li>Let <a href="#widl-PerformanceNavigationTiming-domainLookupStart">domainLookupStart</a>, <a
    href="#widl-PerformanceNavigationTiming-domainLookupEnd">domainLookupEnd</a>, <a
    href="#widl-PerformanceNavigationTiming-connectStart">connectStart</a> and <a
    href="#widl-PerformanceNavigationTiming-connectEnd">connectEnd</a> be the same value as <a
    href="#widl-PerformanceNavigationTiming-fetchStart">fetchStart</a>.</li>
  <li>If the resource is fetched from the <a
    href="http://www.w3.org/TR/html5/browsers.html#relevant-application-cache" title="relevant application cache">relevant
    application cache</a> or local resources, including the
    <a href="https://tools.ietf.org/html/rfc7234">HTTP cache</a> [[RFC7234]],
    go to step <a href="#step-request-start">16</a>.</li>
  <li>If no domain lookup is required, go to step <a
    href="#step-connect-start">14</a>. Otherwise, immediately before a user
    agent starts the domain name lookup, record the time as
    <a href="#widl-PerformanceNavigationTiming-domainLookupStart">domainLookupStart</a>. </li>
  <li>Record the time as <a href="#widl-PerformanceNavigationTiming-domainLookupEnd">domainLookupEnd</a>
    immediately after the domain name lookup is successfully done. A user
    agent MAY need multiple retries before that. If the domain lookup fails,
    abort the rest of the steps. </li>
  <li id="step-connect-start">If a persistent transport connection is used to
    fetch the resource, let <a href="#widl-PerformanceNavigationTiming-connectStart">connectStart</a> and
    <a href="#widl-PerformanceNavigationTiming-connectEnd">connectEnd</a> be the same value of
    <a href="#widl-PerformanceNavigationTiming-domainLookupEnd">domainLookupEnd</a>.
    Otherwise, record the time as <a
    href="#widl-PerformanceNavigationTiming-connectStart">connectStart</a> immediately before initiating
    the connection to the server and record the time as
    <a href="#widl-PerformanceNavigationTiming-connectEnd">connectEnd</a> immediately
    after the connection to the server or the proxy is established. A user agent MAY
    need multiple retries before this time. Once connection is established set the value of <a href="#widl-PerformanceNavigationTiming-nextHopProtocol">nextHopProtocol</a> to the ALPN ID used by the connection. If a connection can not be established, abort the rest of the steps. </li>
  <li>A user agent MUST also
    set the
    <a href="#widl-PerformanceNavigationTiming-secureConnectionStart">secureConnectionStart</a> attribute as follows:
    <ol>
    <li>When a secure transport is used, the user agent MUST
        record the time as <a href="#widl-PerformanceNavigationTiming-secureConnectionStart">secureConnectionStart</a>
        immediately before the handshake process to secure the connection.</li>
    <li>When a secure transport is not used, the user agent MUST
        set the value of <a href="#widl-PerformanceNavigationTiming-secureConnectionStart">secureConnectionStart</a> to 0.</li>
    </ol></li>
  <li id="step-request-start">Immediately before a user agent starts sending
    request for the document, record the current time as <a
    href="#widl-PerformanceNavigationTiming-requestStart">requestStart</a>.</li>
  <li id="step-response-start">Record the time as <a href="#widl-PerformanceNavigationTiming-responseStart">
    responseStart</a> immediately after the user agent receives the first byte
    of the response.</li>
  <li id="step-response-end">Record the time as <a
    href="#widl-PerformanceNavigationTiming-responseEnd">responseEnd</a> immediately after receiving the
    last byte of the response.
    <ol>
    <li>Return to step <a href="#step-connect-start">14</a> if the user agent fails to send the request or receive the entire response, and needs to
    reopen the connection.

    <div class="note">
    <p>When <a href="https://tools.ietf.org/html/rfc7230#section-6.3">persistent
    connection</a> [[!RFC7230]] is enabled, a user agent MAY first try to re-use an open
    connect to send the request while the connection can be <a
    href="https://tools.ietf.org/html/rfc7230#section-6.5">asynchronously
    closed</a>. In such case, connectStart, connectEnd and requestStart SHOULD represent
    timing information collected over the re-open connection.</p>
    </div></li>
    <li>Set the value of <a
    href="#widl-PerformanceNavigationTiming-transferSize">transferSize</a>, <a
    href="#widl-PerformanceNavigationTiming-encodedBodySize">encodedBodySize</a>, <a
    href="#widl-PerformanceNavigationTiming-decodedBodySize">decodedBodySize</a> to corresponding values.</li>
    </ol>
  </li>
  <li>If the fetched resource results in an HTTP redirect or
    <a href="http://www.w3.org/TR/html5/infrastructure.html#concept-http-equivalent-codes" title='HTTP response codes equivalence'>equivalent</a>,
    then
    <ol style="list-style-type:lower-alpha;">
      <li>if the current document and the document that is redirected to are not from the
        same <a href="http://tools.ietf.org/html/rfc6454">origin</a>,
        set <a href="#widl-PerformanceNavigationTiming-redirectStart">redirectStart</a>,
        <a href="#widl-PerformanceNavigationTiming-redirectEnd">redirectEnd</a>,
        <a href="#widl-PerformanceNavigationTiming-unloadEventStart">unloadEventStart</a>,
        <a href="#widl-PerformanceNavigationTiming-unloadEventEnd">unloadEventEnd</a> and
        <a href="#widl-PerformanceNavigationTiming-redirectCount">redirectCount</a> to 0. Then,
        return to step <a href="#step-fetch-start">9</a> with the new resource.</li>
      <li>if there is previous redirect involving documents that are not from the
        same <a href="http://tools.ietf.org/html/rfc6454">origin</a>,
        set <a href="#widl-PerformanceNavigationTiming-redirectStart">redirectStart</a>,
        <a href="#widl-PerformanceNavigationTiming-redirectEnd">redirectEnd</a>,
        <a href="#widl-PerformanceNavigationTiming-unloadEventStart">unloadEventStart</a>,
        <a href="#widl-PerformanceNavigationTiming-unloadEventEnd">unloadEventStart</a> and
        <a href="#widl-PerformanceNavigationTiming-redirectCount">redirectCount</a> to 0. Then,
        return to step <a href="#step-fetch-start">9</a> with the new resource.</li>
      <li>Increment <a href="#widl-PerformanceNavigationTiming-redirectCount">redirectCount</a> by 1.</li>
      <li>If the value of <a href="#widl-PerformanceNavigationTiming-redirectStart">redirectStart</a> is 0,
        let it be the value of <a href="#widl-PerformanceNavigationTiming-fetchStart">fetchStart</a>.</li>
      <li>Let <a href="#widl-PerformanceNavigationTiming-redirectEnd">redirectEnd</a> be the value of
        <a href="#widl-PerformanceNavigationTiming-responseEnd">responseEnd</a>.</li>
      <li>Set all of the attributes in the <a>PerformanceNavigationTiming</a> object to 0 except
        <a href="#widl-PerformanceNavigationTiming-startTime">startTime</a>,
        <a href="#widl-PerformanceNavigationTiming-redirectStart">redirectStart</a>,
        <a href="#widl-PerformanceNavigationTiming-redirectEnd">redirectEnd</a>,
        <a href="#widl-PerformanceNavigationTiming-redirectCount">redirectCount</a>,
        <a href="#widl-PerformanceNavigationTiming-type">type</a>,
        <a href="#widl-PerformanceNavigationTiming-nextHopProtocol">nextHopProtocol</a>,
        <a href="#widl-PerformanceNavigationTiming-unloadEventStart">unloadEventStart</a> and
        <a href="#widl-PerformanceNavigationTiming-unloadEventEnd">unloadEventEnd</a>. Set <a href="#widl-PerformanceNavigationTiming-nextHopProtocol">nextHopProtocol</a> to the empty <code>DOMString</code>.</li>
      <li>Return to step <a href="#step-fetch-start">9</a> with the new resource.</li>
    </ol>
  </li>
  <li>Record the time as <a href="#widl-PerformanceNavigationTiming-domInteractive">domInteractive</a>
    immediately before the user agent sets the <a
    href="http://www.w3.org/TR/html5/dom.html#current-document-readiness">current
    document readiness</a> to "interactive".</li>
  <li>Record the time as <a
    href="#widl-PerformanceNavigationTiming-domContentLoadedEventStart">domContentLoadedEventStart</a> immediately before the
    user agent fires the <a href="http://www.w3.org/TR/html5/syntax.html#the-end">DOMContentLoaded event</a> at the document.</li>
  <li>Record the time as <a
    href="#widl-PerformanceNavigationTiming-domContentLoadedEventEnd">domContentLoadedEventEnd</a> immediately after
    the <a href="http://www.w3.org/TR/html5/syntax.html#the-end">
    DOMContentLoaded event</a> completes.</li>
  <li>Record the time as <a href="#widl-PerformanceNavigationTiming-domComplete">domComplete</a>
    immediately before the user agent sets the <a
    href="http://www.w3.org/TR/html5/dom.html#current-document-readiness">current
    document readiness</a> to "complete".</li>
  <li>Record the time as <a href="#widl-PerformanceNavigationTiming-loadEventStart">loadEventStart</a>
    immediately before the user agent fires the load event.</li>
  <li>Record the time as <a href="#widl-PerformanceNavigationTiming-loadEventEnd">loadEventEnd</a>
    immediately after the user agent completes the load event.</li>
  <li>Record the time as <a href="#widl-PerformanceNavigationTiming-prerenderSwitch">prerenderSwitch</a>
    immediately after the user agent changes the <a href="http://www.w3.org/TR/page-visibility/#dom-document-visibilitystate">visibilityState</a>
    from <code>prerender</code> to <code>visible</code>. Otherwise, set this attribute to 0.</li>
  <li>
    Set the <a href="#widl-PerformanceNavigationTiming-duration">duration</a> to a <a href="http://www.w3.org/TR/hr-time-2/#dom-domhighrestimestamp">DOMHighResTimeStamp</a>
	equal to the difference between <a href="#widl-PerformanceNavigationTiming-loadEventEnd">loadEventEnd</a> and <a href="#widl-PerformanceNavigationTiming-startTime">startTime</a>, respectively.
  </li>
  <li><a href='http://w3c.github.io/performance-timeline/#dfn-queue-a-performanceentry'>Queue</a> the new <a>PerformanceNavigationTiming</a> object.</li>
  <li>Add the new <a>PerformanceNavigationTiming</a> object to the <a href='https://w3c.github.io/performance-timeline/#dfn-performance-entry-buffer'>performance entry buffer</a>.</li>
</ol>

<p>Some user agents maintain the DOM structure of the document in memory
during navigation operations such as forward and backward. In those cases,
the <a>PerformanceNavigationTiming</a> object MUST NOT
be altered during the navigation.</p>
</section>

</section>
<section id="privacy" class='informative'>
<h2>Privacy</h2>

<section id="info_disclosure">
<h3>Information disclosure</h3>

<p>There is the potential for disclosing an end-user's browsing and activity history by using
carefully crafted timing attacks. For instance, the unloading time reveals how long the previous
page takes to execute its unload handler, which could be used to infer the user's login status.
These attacks have been mitigated by enforcing the same
<a href="http://tools.ietf.org/html/rfc6454">origin</a> policy when
timing information involving the previous navigation is accessed. [[RFC6454]]</p>

<p>The <a href="http://www.w3.org/TR/html5/browsers.html#relaxing-the-same-origin-restriction">
relaxed same origin policy</a> doesn't provide sufficient protection against unauthorized visits
across documents. In shared hosting, an untrusted third party is able to host an HTTP server at the same
IP address but on a different port.</p>
</section>

<section id="cross-directory">
<h3>Cross-directory access</h3>

<p>Different pages sharing one host name, for example contents from different authors hosted
on sites with user generated content are considered from the same origin because there is no
feature to restrict the access by pathname. Navigating between these pages allows a latter page
to access timing information of the previous one, such as timing regarding redirection and unload event.</p>
</section>
</section>

<section id="security" class='informative'>
<h2>Security</h2>

<p>The <a href="#performancenavigationtiming">PerformanceNavigationTiming</a> interface exposes timing information for the <a>current document</a> to any resource loaded by the document, such as a web page or a worker. To limit the access to the <a href="#performancenavigationtiming">PerformanceNavigationTiming</a> interface, the <a href="https://tools.ietf.org/html/rfc6454#section-5">same origin</a>
policy is enforced by default and certain attributes are set to zero, as described in <a href="http://www.w3.org/TR/resource-timing/#cross-origin-resources" class="sec-ref"><span class="secno">4.5</span> <span class="sec-title">Cross-origin Resources</span></a> [[!RESOURCE-TIMING]]. Resource providers can
explicitly allow all timing information to be collected for a <a>current document</a> by
adding the <a href="#timing-allow-origin">Timing-Allow-Origin</a> HTTP response header, which specifies the
domains that are allowed to access the timing information. </p>

<section id="authentication">
<h3>Detecting proxy servers</h3>
<p>In case a proxy is deployed between the user agent and the web server, the time interval
between the <a href="#widl-PerformanceNavigationTiming-connectStart">connectStart</a> and the
<a href="#widl-PerformanceNavigationTiming-connectEnd">connectEnd</a> attributes indicates the delay between the user agent
and the proxy instead of the web server. With that, web server can potentially infer the
existence of the proxy. For SOCKS proxy, this time interval includes the proxy authentication
time and time the proxy takes to connect to the web server, which obfuscate the proxy detection.
In case of an HTTP proxy, the user agent might not have any knowledge about the proxy server at
all so it's not always feasible to mitigate this attack.</p>
</section>
</section>

<section class='appendix'>
<h2>Historical</h2>

<p>
This section defines attributes and interfaces previously introduced in [[NAVIGATION-TIMING]] and are kept here for legacy purposes. Authors are advised to use the <a>PerformanceNavigationTiming</a> interface instead.
</p>
<p>All time values defined in this appendix are measured in milliseconds since midnight of <time datetime="1970-01-01T00:00Z">January 1, 1970 (UTC)</time>.</p>


<section>
<h3>The PerformanceTiming interface</h3>

<dl title='[Exposed=Window] interface PerformanceTiming' class='idl'>
<dt>readonly attribute unsigned long long navigationStart</dt>
<dd>

<p>This attribute must return the time immediately after the user agent finishes <a
href="http://www.w3.org/TR/html5/browsers.html#prompt-to-unload-a-document">prompting
to unload</a> the previous document. If there is no previous document, this attribute must return the time the current document is created.

</dd>
<dt>readonly attribute unsigned long long unloadEventStart</dt>
<dd>

<p>If the previous document and the current document have the same
<a href="http://tools.ietf.org/html/rfc6454">origin</a>
[[!RFC6454]],
this attribute must return the time immediately before the user agent starts
the <a href="http://www.w3.org/TR/html5/browsers.html#unloading-documents">unload</a>
event of the previous document.

If there is no previous document or the previous document has a
different <a href="http://tools.ietf.org/html/rfc6454">origin</a> than the
current document, this attribute must return zero.</p>

</dd>
<dt>readonly attribute unsigned long long unloadEventEnd</dt>
<dd>

<p>If the previous document and the current document have the
same <a href="http://tools.ietf.org/html/rfc6454">same origin</a>,
this attribute must return the time immediately after the user agent finishes the
<a href="http://www.w3.org/TR/html5/browsers.html#unload-a-document">unload</a>
event of the previous document. If there is no previous document or the previous document has
a different <a href="http://tools.ietf.org/html/rfc6454">origin</a> than the
current document or the unload is not yet completed, this attribute must return zero.</p>

<p>If there are HTTP redirects
<a href="http://www.w3.org/TR/html5/infrastructure.html#concept-http-equivalent-codes">or equivalent</a>
when navigating and not all the redirects or equivalent are from the
same <a href="http://tools.ietf.org/html/rfc6454">origin</a>,
both <a href="#widl-PerformanceTiming-unloadEventStart">unloadEventStart</a> and
<a href="#widl-PerformanceTiming-unloadEventEnd">unloadEventEnd</a> must return the zero.</p>

</dd>
<dt>readonly attribute unsigned long long redirectStart</dt>
<dd>

<p>If there are HTTP redirects
<a href="http://www.w3.org/TR/html5/infrastructure.html#concept-http-equivalent-codes">or equivalent</a>
when navigating and if all the redirects or equivalent are from the
same <a href="http://tools.ietf.org/html/rfc6454">origin</a>,
this attribute must return the <a href="#widl-PerformanceTiming-fetchStart">starting time
of the fetch</a> that initiates the redirect. Otherwise, this attribute must return zero.</p>

</dd>
<dt>readonly attribute unsigned long long redirectEnd</dt>
<dd>

<p>If there are HTTP redirects
<a href="http://www.w3.org/TR/html5/infrastructure.html#concept-http-equivalent-codes">or equivalent</a>
when navigating and all redirects and equivalents are from the
same <a href="http://tools.ietf.org/html/rfc6454">origin</a>,
this attribute must return the time immediately after receiving the last byte of
the response of the last redirect. Otherwise, this attribute must return zero.</p>

</dd>
<dt>readonly attribute unsigned long long fetchStart</dt>
<dd>

<p>If the new resource is to be
<a href="http://www.w3.org/TR/html5/infrastructure.html#fetching-resources">fetched</a> using HTTP GET
<a href="http://www.w3.org/TR/html5/infrastructure.html#concept-http-equivalent-get">or
equivalent</a>, fetchStart must return the time immediately before the user agent starts
checking <a href="http://www.w3.org/TR/html5/browsers.html#relevant-application-cache">
any relevant application caches</a>. Otherwise, it must return the time when the
user agent starts
<a href="http://www.w3.org/TR/html5/infrastructure.html#fetching-resources">fetching</a> the resource.</p>

</dd>
<dt>readonly attribute unsigned long long domainLookupStart</dt>
<dd>

<p>This attribute must return the time immediately before the user agent starts the domain name
lookup for the current document.
If a <a href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec8.html#sec8.1">persistent
connection</a> [[!RFC2616]] is used or the current document
is retrieved from <a href="http://www.w3.org/TR/html5/browsers.html#relevant-application-cache">relevant
application caches</a> or local resources,
this attribute must return the same value as <a href="#widl-PerformanceTiming-fetchStart">fetchStart</a>. </p>

</dd>
<dt>readonly attribute unsigned long long domainLookupEnd</dt>
<dd>

<p>This attribute must return the time immediately after the user agent
finishes the domain name lookup for the current document.
If a <a href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec8.html#sec8.1">persistent
connection</a> [[!RFC2616]] is used or the current document
is retrieved from <a href="http://www.w3.org/TR/html5/browsers.html#relevant-application-cache">relevant
application caches</a> or local resources,
this attribute must return the same value as <a href="#widl-PerformanceTiming-fetchStart">fetchStart</a>. </p>

<div class="note">
<p>Checking and retrieving contents from the
<a href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec13.html#sec13">HTTP cache</a> [[!RFC2616]]
is part of the <a href="http://www.w3.org/TR/html5/infrastructure.html#fetching-resources">
fetching process</a>. It's covered by the
<a href="#widl-PerformanceTiming-requestStart">requestStart</a>,
<a href="#widl-PerformanceTiming-responseStart">responseStart</a> and
<a href="#widl-PerformanceTiming-responseEnd">responseEnd</a> attributes.</p>
</div>
<p class="note">In case where the user agent already has the domain information in cache,
domainLookupStart and domainLookupEnd represent the times when the user agent
starts and ends the domain data retrieval from the cache. </p>
</dd>
<dt>readonly attribute unsigned long long connectStart</dt>
<dd>

<p>This attribute must return the time immediately before the user agent start
establishing the connection to the server to retrieve the document.
If a <a href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec8.html#sec8.1">persistent
connection</a> [[!RFC2616]] is used or the current document is retrieved from <a
href="http://www.w3.org/TR/html5/browsers.html#relevant-application-cache">relevant
application caches</a> or local resources,
this attribute must return value of <a href="#widl-PerformanceTiming-domainLookupEnd">domainLookupEnd</a>.</p>

</dd>
<dt>readonly attribute unsigned long long connectEnd</dt>
<dd>

<p>This attribute must return the time immediately after the user agent
finishes establishing the connection to the server to retrieve the current document.
If a <a
href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec8.html#sec8.1">persistent
connection</a> [[!RFC2616]] is used or the current document is retrieved from <a
href="http://www.w3.org/TR/html5/browsers.html#relevant-application-cache">relevant
application caches</a> or local resources,
this attribute must return the value of <a href="#widl-PerformanceTiming-domainLookupEnd">domainLookupEnd</a>
</p>

<p>If the transport connection fails and the user agent reopens a connection,
<a href="#widl-PerformanceTiming-connectStart">connectStart</a> and
<a href="#widl-PerformanceTiming-connectEnd">connectEnd</a> should return the corresponding
values of the new connection. </p>
<p>
<a href="#widl-PerformanceTiming-connectEnd">connectEnd</a> must include the time interval to
establish the transport connection as well as other time interval
such as SSL handshake and SOCKS authentication.
</p>

</dd>
<dt>readonly attribute unsigned long long secureConnectionStart</dt>
<dd>

<p>This attribute is optional. User agents that don't have this attribute
available must set it as undefined. When this attribute is available, if the
<a href="http://www.w3.org/TR/html5/infrastructure.html#url-scheme">scheme</a> of the
current page is <a href="http://tools.ietf.org/html/rfc2817">HTTPS</a>, this
attribute must return the time immediately before the user agent starts the
handshake process to secure the current connection. If this attribute is
available but HTTPS is not used, this attribute must return zero.
</p>

</dd>
<dt>readonly attribute unsigned long long requestStart</dt>
<dd>

<p>This attribute must return the time immediately before the user agent
starts requesting the current document from the server, or from
<a href="http://www.w3.org/TR/html5/browsers.html#relevant-application-cache">
relevant application caches</a> or from local resources.</p>

<p>If the transport connection fails after a request is sent and the user
agent reopens a connection and resend the request, <a
href="#widl-PerformanceTiming-requestStart">requestStart</a> should return the corresponding values
of the new request.</p>

<div class="note">
<p>This interface does not include an attribute to represent the completion of
sending the request, e.g., requestEnd.
<ul>
<li>Completion of sending the request from the user agent does not always
indicate the corresponding completion time in the network transport, which
brings most of the benefit of having such an attribute.</li>
<li>Some user agents have high cost to determine the actual completion time of
sending the request due to the HTTP layer encapsulation.</li>
</ul>
</div>

</dd>
<dt>readonly attribute unsigned long long responseStart</dt>
<dd>

<p>This attribute must return the time immediately after the user agent receives the first
byte of the response from the server, or from
<a href="http://www.w3.org/TR/html5/browsers.html#relevant-application-cache">relevant
application caches</a> or from local resources. </p>

</dd>
<dt>readonly attribute unsigned long long responseEnd</dt>
<dd>

<p>This attribute must return the time immediately after the user agent
receives the last byte of the current document or immediately before the
transport connection is closed, whichever comes first. The document here
can be received either from the server,
<a href="http://www.w3.org/TR/html5/browsers.html#relevant-application-cache">relevant
application caches</a> or from local resources.</p>

</dd>
<dt>readonly attribute unsigned long long domLoading</dt>
<dd>

<p>This attribute must return the time immediately before the user agent sets the
<a href="http://www.w3.org/TR/html5/dom.html#current-document-readiness">current
document readiness</a> to
<a href="http://www.w3.org/TR/html5/dom.html#current-document-readiness">"loading"</a>.</p>
<p class="warning">Due to differences in when a Document object is created in existing user agents,
 the value returned by the <code>domLoading</code> is implementation specific and should not be used
 in meaningful metrics.</p>

</dd>
<dt>readonly attribute unsigned long long domInteractive</dt>
<dd>

<p>This attribute must return the time immediately before the user agent sets the
<a href="http://www.w3.org/TR/html5/dom.html#current-document-readiness">current
document readiness</a> to
<a href="http://www.w3.org/TR/html5/syntax.html#the-end">"interactive"</a>.</p>

</dd>
<dt>readonly attribute unsigned long long domContentLoadedEventStart</dt>
<dd>

<p>This attribute must return the time immediately before the user agent fires <a
href="http://www.w3.org/TR/html5/syntax.html#the-end">the DOMContentLoaded
event</a> at the <a href="http://www.w3.org/TR/html5/dom.html#document"><code>Document</code></a>.</p>

</dd>
<dt>readonly attribute unsigned long long domContentLoadedEventEnd</dt>
<dd>

<p>This attribute must return the time immediately after the document's <a
href="http://www.w3.org/TR/html5/syntax.html#the-end">DOMContentLoaded
event</a> completes.</p>

</dd>
<dt>readonly attribute unsigned long long domComplete</dt>
<dd>

<p>This attribute must return the time immediately before the user agent sets the
<a href="http://www.w3.org/TR/html5/dom.html#current-document-readiness">current
document readiness</a> to
<a href="http://www.w3.org/TR/html5/syntax.html#the-end">"complete"</a>.</p>

<p>If the <a href="http://www.w3.org/TR/html5/dom.html#current-document-readiness">
current document readiness</a> changes to the same state multiple times,
<a href="#widl-PerformanceTiming-domLoading">domLoading</a>,
<a href="#widl-PerformanceTiming-domInteractive">domInteractive</a>,
<a href="#widl-PerformanceTiming-domContentLoadedEventStart">domContentLoadedEventStart</a>,
<a href="#widl-PerformanceTiming-domContentLoadedEventEnd">domContentLoadedEventEnd</a> and
<a href="#widl-PerformanceTiming-domComplete">domComplete</a> must return the time of the first
occurrence of the corresponding
<a href="http://www.w3.org/TR/html5/dom.html#current-document-readiness">document readiness</a>
change.</p>

</dd>
<dt>readonly attribute unsigned long long loadEventStart</dt>
<dd>

<p>This attribute must return the time immediately before the load event of
the current document is fired. It must return zero when the load event is not
fired yet.</p>

</dd>
<dt>readonly attribute unsigned long long loadEventEnd</dt>
<dd>

<p>This attribute must return the time when the load event of the current
document is completed. It must return zero when the load event is not fired
or is not completed.</p>
</dd>
<dt>serializer = { attribute }</dt>
</dl>
</section>

<section>
<h3>The <code>PerformanceNavigation</code> interface</h3>
<dl class="idl" title='[Exposed=Window] interface PerformanceNavigation'>
  <dt>const unsigned short TYPE_NAVIGATE = 0</dt>
  <dd><p>Navigation started by clicking on a link, or entering the URL in the user
    agent's address bar, or form submission, or initializing through a script operation other than
    the ones used by <code>TYPE_RELOAD</code>
    and <code>TYPE_BACK_FORWARD</code> as listed below.</p></dd>
  <dt>const unsigned short TYPE_RELOAD = 1</dt>
    <dd><p>Navigation through
    the reload operation or the
    <a href="http://www.w3.org/TR/html5/browsers.html#dom-location-reload">location.reload()</a>
    method.</p></dd>
  <dt>const unsigned short TYPE_BACK_FORWARD = 2</dt>
   <dd><p>Navigation
  through a <a href="http://www.w3.org/TR/html5/browsers.html#traverse-the-history">history traversal</a> operation.</p></dd>
  <dt>const unsigned short TYPE_RESERVED = 255</dt>
  <dd><p>Any navigation types not defined by values above.</p></dd>

<dt>readonly attribute unsigned short type</dt>
<dd>

<p>This attribute must return the type of the last non-redirect <a
href="http://www.w3.org/TR/html5/browsers.html#navigate">navigation</a>
in the current browsing context. It must have one of the following <a
href="#widl-PerformanceNavigation-type">navigation type</a> values. </p>

<p class="note">Client-side redirects, such as those using <a href="hhttp://www.w3.org/TR/html5/document-metadata.html#attr-meta-http-equiv-refresh">the Refresh pragma directive</a>,
are not considered HTTP redirects <a href="http://www.w3.org/TR/html5/infrastructure.html#concept-http-equivalent-codes">or equivalent</a> by this spec.
In those cases, the <a href="#widl-PerformanceNavigation-type">type</a> attribute should return appropriate value,
such as <code>TYPE_RELOAD</code> if reloading the current page, or
<code>TYPE_NAVIGATE</code> if navigating to a new URL.</p>

</dd>
<dt>readonly attribute unsigned short redirectCount</dt>
<dd>

<p>This attribute must return the number of redirects since the last
non-redirect navigation under the current browsing context. If there is no
redirect or there is any redirect that is not from the same
<a href="http://tools.ietf.org/html/rfc6454">
origin</a> as the destination document, this attribute must return zero. </p>
</dd>
<dt>serializer = { attribute }</dt>
</dl>

</section>

<section>
<h3>Extensions to the <code>Performance</code> interface</h3>

<dl class='idl' title='[Exposed=Window] partial interface Performance'>

<dt>[SameObject] readonly attribute PerformanceTiming timing</dt>
<dd>
<p>
  The <code>timing</code> attribute
  represents the timing information related to the browsing contexts since the
  last non-redirect navigation. This attribute is defined by the <code>PerformanceTiming</code> interface.
</p>
</dd>
<dt>[SameObject] readonly attribute PerformanceNavigation navigation</dt>
<dd>
<p>
  The <code>navigation</code> attribute is defined by the <code>PerformanceNavigation</code> interface.
</p>
</dd>
</dl>
</section>

</section>

<section id="acknowledgements" class="appendix">
<h2>Acknowledgments</h2>

<p>We would like to offer our sincere thanks to James Simonsen, Tony Gentilcore, Zhiheng Wang, Karen Anderson and Jason Weber for all their contributions to this work.</p>
</section>
</body>
</html>
